<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <title>FMA App</title>
</head>
<body>
    <div class="wrapper">
        <nav>
            <div class="logo">
                <a href="https://farnhammartialarts.co.uk/" target="_blank"><img src="https://res.cloudinary.com/dvp3fdavw/image/upload/v1737716047/FMA_logo_jdb3km.png" alt="FMA logo" id="logo"></a>
                <h1>Farnham Martial Arts</h1>
            </div>
            <div class="nav">
                <div class="icons"><a href="/">Home</a></div>
                <% if (user) { %>
                    <div class="icons"><a href="/members/new">Add Profile</a></div>
                <% } %>
                <div class="dropdown-container">
                    <button class="dropdown-button" id="belt-link"><a href="/members">Members<span class="arrow"> â–¼</span></a></button>
                    <div class="dropdown-content" id="belts-section">
                        <a href="/members/belt/Black"><img src="https://res.cloudinary.com/dvp3fdavw/image/upload/v1763715417/black-belt_yemcfh.png" id="belt-icon"> Black Belt</a>
                        <a href="/members/belt/Brown"><img src="https://res.cloudinary.com/dvp3fdavw/image/upload/v1763715436/brown-belt_penfxb.png" id="belt-icon"> Brown Belt</a>
                        <a href="/members/belt/Purple"><img src="https://res.cloudinary.com/dvp3fdavw/image/upload/v1763715436/purple-belt_n3k1qu.png" id="belt-icon"> Purple Belt</a>
                        <a href="/members/belt/Blue"><img src="https://res.cloudinary.com/dvp3fdavw/image/upload/v1763715436/bue-belt_twmwws.png" id="belt-icon"> Blue Belt</a>
                        <a href="/members/belt/White"><img src="https://res.cloudinary.com/dvp3fdavw/image/upload/v1763715436/white-belt_stnxxv.png" id="belt-icon"> White Belt</a>
                    </div>
                </div>
                <% if (user) { %>
                    <div class="icons"><a href="#" onclick="document.getElementById('logout-form').submit();" class="btn btn-danger text-white">Sign out</a>
                        <form id="logout-form" action="/logout" method="POST" style="display: none;"></form>
                    </div>
                <% } else {%>
                <div class="icons"><a href="views/user/new">Register</a></div>
                <div class="icons"><div class="icons"><a href="/login" onclick="document.getElementById('logout-form').submit();" class="btn btn-primary text-white">Sign in</a></div>
                <% } %>
            </div>
        </nav>
    </div>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            const dropdownButton = document.getElementById('belt-link');
            const dropdownContent = document.getElementById('belts-section');
            const arrow = dropdownButton.querySelector('.arrow');

            // Guard in case elements are missing
            if (!dropdownButton || !dropdownContent) return;

            let isVisible = false;

            // Toggle dropdown visibility. Allow anchor clicks to navigate to their href.
            dropdownButton.addEventListener('click', function(e) {
                // If the user clicked the anchor inside the button, allow navigation
                if (e.target && e.target.tagName === 'A') {
                    return; // let the browser follow the link
                }
                e.preventDefault();
                e.stopPropagation();
                isVisible = !isVisible;
                dropdownContent.style.display = isVisible ? 'flex' : 'none';
                if (arrow) arrow.classList.toggle('rotate', isVisible);
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                if (isVisible) {
                    isVisible = false;
                    dropdownContent.style.display = 'none';
                    if (arrow) arrow.classList.remove('rotate');
                }
            });

            // Prevent dropdown from closing when clicking inside it
            dropdownContent.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        });
    </script>